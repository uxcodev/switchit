{"version":3,"file":"auth0-vue.cjs.js","sources":["../../src/token.ts","../../src/version.ts","../../src/utils.ts","../../src/plugin.ts","../../src/index.ts","../../src/index.cjs.ts"],"sourcesContent":["import type { InjectionKey } from 'vue';\nimport type { Auth0VueClient } from './interfaces';\n\n/**\n * @ignore\n */\nexport const AUTH0_TOKEN = '$auth0';\n\n/**\n * Injection token used to `provide` the `Auth0VueClient` instance. Can be used to pass to `inject()`\n *\n * ```js\n * inject(AUTH0_INJECTION_KEY)\n * ```\n */\nexport const AUTH0_INJECTION_KEY: InjectionKey<Auth0VueClient> =\n  Symbol(AUTH0_TOKEN);\n","export default '2.0.0';\n","import { watchEffect } from 'vue';\n\n/**\n * @ignore\n * Run watchEffect untill the watcher returns true, then stop the watch.\n * Once it returns true, the promise will resolve.\n */\nexport function watchEffectOnceAsync<T>(watcher: () => T) {\n  return new Promise<void>(resolve => {\n    watchEffectOnce(watcher, resolve);\n  });\n}\n\n/**\n * @ignore\n * Run watchEffect untill the watcher returns true, then stop the watch.\n * Once it returns true, it will call the provided function.\n */\nexport function watchEffectOnce<T>(watcher: () => T, fn: Function) {\n  const stopWatch = watchEffect(() => {\n    if (watcher()) {\n      fn();\n      stopWatch();\n    }\n  });\n}\n\n/**\n * @ignore\n * Helper function to bind methods to itself, useful when using Vue's `provide` / `inject` API's.\n */\nexport function bindPluginMethods(plugin: any, exclude: string[]) {\n  Object.getOwnPropertyNames(Object.getPrototypeOf(plugin))\n    .filter(method => !exclude.includes(method)) \n    // eslint-disable-next-line security/detect-object-injection\n    .forEach(method => (plugin[method] = plugin[method].bind(plugin))); \n}\n","import type { App, Ref } from 'vue';\nimport { readonly, ref } from 'vue';\nimport type { Router } from 'vue-router';\nimport type {\n  AppState,\n  Auth0PluginOptions,\n  Auth0VueClient,\n  Auth0VueClientOptions,\n  LogoutOptions,\n  RedirectLoginOptions,\n} from './interfaces';\nimport { AUTH0_INJECTION_KEY, AUTH0_TOKEN } from './token';\nimport version from './version';\nimport type {\n  GetTokenSilentlyOptions,\n  GetTokenSilentlyVerboseResponse,\n  GetTokenWithPopupOptions,\n  IdToken,\n  PopupConfigOptions,\n  PopupLoginOptions,\n  RedirectLoginResult,\n} from '@auth0/auth0-spa-js';\nimport {\n  Auth0Client,\n  User\n} from '@auth0/auth0-spa-js';\nimport { bindPluginMethods } from './utils';\n\n/**\n * @ignore\n */\nexport const client: Ref<Auth0VueClient> = ref(null);\n\n/**\n * @ignore\n */\nexport class Auth0Plugin implements Auth0VueClient {\n  private _client: Auth0Client;\n  private _isLoading: Ref<boolean> = ref(true);\n  private _isAuthenticated: Ref<boolean> = ref(false);\n  private _user: Ref<User> = ref({});\n  private _idTokenClaims: Ref<IdToken> = ref();\n  private _error = ref(null);\n\n  isLoading = readonly(this._isLoading);\n  isAuthenticated = readonly(this._isAuthenticated);\n  user = readonly(this._user);\n  idTokenClaims = readonly(this._idTokenClaims);\n  error = readonly(this._error);\n\n  constructor(\n    private clientOptions: Auth0VueClientOptions,\n    private pluginOptions?: Auth0PluginOptions\n  ) {\n    // Vue Plugins can have issues when passing around the instance to `provide`\n    // Therefor we need to bind all methods correctly to `this`.\n    bindPluginMethods(this, ['constructor']);\n  }\n\n  install(app: App) {\n    this._client = new Auth0Client({\n      ...this.clientOptions,\n      auth0Client: {\n        name: 'auth0-vue',\n        version: version\n      }\n    });\n\n    this.__checkSession(app.config.globalProperties.$router);\n\n    // eslint-disable-next-line security/detect-object-injection\n    app.config.globalProperties[AUTH0_TOKEN] = this;\n    app.provide(AUTH0_INJECTION_KEY, this);\n\n    client.value = this;\n  }\n\n  async loginWithRedirect(options?: RedirectLoginOptions<AppState>) {\n    return this._client.loginWithRedirect(options);\n  }\n\n  async loginWithPopup(\n    options?: PopupLoginOptions,\n    config?: PopupConfigOptions\n  ) {\n    return this.__proxy(() => this._client.loginWithPopup(options, config));\n  }\n\n  async logout(options?: LogoutOptions) {\n    if (options?.openUrl || options?.openUrl === false) {\n      return this.__proxy(() => this._client.logout(options));\n    }\n\n    return this._client.logout(options);\n  }\n\n  /* istanbul ignore next */\n  async getAccessTokenSilently(\n    options: GetTokenSilentlyOptions & { detailedResponse: true }\n  ): Promise<GetTokenSilentlyVerboseResponse>;\n  /* istanbul ignore next */\n  async getAccessTokenSilently(\n    options?: GetTokenSilentlyOptions\n  ): Promise<string>;\n  /* istanbul ignore next */\n  async getAccessTokenSilently(\n    options: GetTokenSilentlyOptions = {}\n  ): Promise<string | GetTokenSilentlyVerboseResponse> {\n    return this.__proxy(() => this._client.getTokenSilently(options));\n  }\n\n  async getAccessTokenWithPopup(\n    options?: GetTokenWithPopupOptions,\n    config?: PopupConfigOptions\n  ) {\n    return this.__proxy(() => this._client.getTokenWithPopup(options, config));\n  }\n\n  async checkSession(options?: GetTokenSilentlyOptions) {\n    return this.__proxy(() => this._client.checkSession(options));\n  }\n\n  async handleRedirectCallback(\n    url?: string\n  ): Promise<RedirectLoginResult<AppState>> {\n    return this.__proxy(() =>\n      this._client.handleRedirectCallback<AppState>(url)\n    );\n  }\n\n  private async __checkSession(router?: Router) {\n    const search = window.location.search;\n\n    if (\n      (search.includes('code=') || search.includes('error=')) &&\n      search.includes('state=') &&\n      !this.pluginOptions?.skipRedirectCallback\n    ) {\n      const result = await this.handleRedirectCallback();\n      const appState = result?.appState;\n      const target = appState?.target ?? '/';\n\n      window.history.replaceState({}, '', '/');\n\n      if (router) {\n        router.push(target);\n      }\n\n      return result;\n    } else {\n      await this.checkSession();\n    }\n  }\n\n  private async __refreshState() {\n    this._isAuthenticated.value = await this._client.isAuthenticated();\n    this._user.value = await this._client.getUser();\n    this._idTokenClaims.value = await this._client.getIdTokenClaims();\n    this._isLoading.value = false;\n  }\n\n  private async __proxy<T>(cb: () => T, refreshState = true) {\n    let result;\n    try {\n      result = await cb();\n      this._error.value = null;\n    } catch (e) {\n      this._error.value = e;\n      throw e;\n    } finally {\n      if (refreshState) {\n        await this.__refreshState();\n      }\n    }\n\n    return result;\n  }\n}\n","import { inject } from 'vue';\nimport './global';\nimport {\n  Auth0VueClient,\n  Auth0Plugin,\n  Auth0PluginOptions,\n  Auth0VueClientOptions\n} from './global';\nimport { AUTH0_INJECTION_KEY, AUTH0_TOKEN } from './token';\n\nexport * from './global';\nexport { AUTH0_INJECTION_KEY } from './token';\n\ndeclare module '@vue/runtime-core' {\n  export interface ComponentCustomProperties {\n    [AUTH0_TOKEN]: Auth0VueClient;\n  }\n}\n\n/**\n * Creates the Auth0 plugin.\n *\n * @param clientOptions The Auth Vue Client Options\n * @param pluginOptions Additional Plugin Configuration Options\n * @returns An instance of Auth0Plugin\n */\nexport function createAuth0(\n  clientOptions: Auth0VueClientOptions,\n  pluginOptions?: Auth0PluginOptions\n) {\n  return new Auth0Plugin(clientOptions, pluginOptions);\n}\n\n/**\n * Returns the registered Auth0 instance using Vue's `inject`.\n * @returns An instance of Auth0VueClient\n */\nexport function useAuth0(): Auth0VueClient {\n  return inject(AUTH0_INJECTION_KEY);\n}\n","import { createAuth0, useAuth0 } from './index';\n\nconst Auth0Vue = { createAuth0, useAuth0 };\n\nexport default Auth0Vue;\n"],"names":["ref","readonly","Auth0Client","inject"],"mappings":"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"}